
SECTION asm_lib
PUBLIC DETECTMACHINETYPE
PUBLIC PRMACHINETYPE

EXTERN PRSTRNG3

;INCLUDE "../../z88dk-zxspectrum-equates.asm"

.DETECTMACHINETYPE
			LD A,(2899)							; :dbolli:20221102 20:45:22 $0B53 as per https://spectrumcomputing.co.uk/forums/viewtopic.php?p=24955#p24955

			RET

.PRMACHINETYPE
			CALL DETECTMACHINETYPE
			
			CP MACHINETYPE16OR48K
			JR NZ,PRMACHINETYPE2

			LD HL,MACHINETYPE16OR48KMESS
			JP PRSTRNG3

.PRMACHINETYPE2

			CP MACHINETYPE128KORPLUS2
			JR NZ,PRMACHINETYPE3

			LD HL,MACHINETYPE128KORPLUS2MESS
			JP PRSTRNG3

.PRMACHINETYPE3

			CP MACHINETYPE2A2BORPLUS3
			JR NZ,PRMACHINETYPEUNKNOWN

			LD HL,MACHINETYPE2A2BORPLUS3MESS
			JP PRSTRNG3

.PRMACHINETYPEUNKNOWN

			LD HL,MACHINETYPEUNKNOWNMESS
			CALL PRSTRNG3

;.PRMACHINETYPEEXIT

			RET

SECTION asm_lib_data
PUBLIC MACHINETYPE16OR48K
PUBLIC MACHINETYPE128KORPLUS2
PUBLIC MACHINETYPE2A2BORPLUS3

PUBLIC MACHINETYPE16OR48KMESS
PUBLIC MACHINETYPE128KORPLUS2MESS
PUBLIC MACHINETYPE2A2BORPLUS3MESS
PUBLIC MACHINETYPEUNKNOWNMESS

DEFGROUP										; :dbolli:20221102 20:49:45 Added. enum equivalent
{
	MACHINETYPE16OR48K = 165
	MACHINETYPE128KORPLUS2 = 159
	MACHINETYPE2A2BORPLUS3 = 126
}

.MACHINETYPE16OR48KMESS
	DEFM "ZX Spectrum 16K or 48K", $00

.MACHINETYPE128KORPLUS2MESS
	DEFM "ZX Spectrum 128K or Plus 2", $00

.MACHINETYPE2A2BORPLUS3MESS
	DEFM "ZX Spectrum 2A, 2B or Plus 3", $00

.MACHINETYPEUNKNOWNMESS
	DEFM "ZX Spectrum Unknown Type", $00
